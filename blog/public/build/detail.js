function init(){$("body").on("click","#respondBtn",doRespond)}function doRespond(){$.ajax({type:"POST",url:"/addComment",contentType:"application/json",dataType:"json",data:JSON.stringify({news:$("#news").val(),content:$("#resContent").val(),from:$.cookie("id"),to:$("#rid").val(),comment:$("#cid").val()}),success:function(a){99==a.code?alert("出错"):(alert("成功！"),location.href=a.data._id)}})}function init(){$("#loginform").validate({errorLabelContainer:"#errorMsg",wrapper:"span",submitHandler:function(a){doLogin()}}),$("body").on("click","#loginBtn",doLogin)}function doLogin(){$.ajax({type:"POST",url:"/login",contentType:"application/json",dataType:"json",data:JSON.stringify({usr:$("#usr").val(),pwd:$("#pwd").val()}),success:function(a){99==a.code?$(".login-box-msg").text(a.msg):($.cookie("username",a.data.username,{expires:30}),$.cookie("password",a.data.password,{expires:30}),$.cookie("id",a.data._id,{expires:30}),$.cookie("userThumb",a.data.userThumb,{expires:30}),location.href="/blogs")}})}function init(){preChapId="",updateChapId="",moocId=$("#moocId").text()}function cbSetChapContent(a){$(".loader-wrapper").hide();var b=a.content,c=new Remarkable("full",{linkify:!0,highlight:function(a,b){if(b&&hljs.getLanguage(b))try{return hljs.highlight(b,a).value}catch(a){}try{return hljs.highlightAuto(a).value}catch(a){}return""}});b=c.render(b),$("#moocContent").empty(),$("#moocContent").append(b),hljs.initHighlightingOnLoad()}function postData(a,b,c){$(".loader-wrapper").show();var d=$.ajax({type:"post",url:a,dataType:"json",contentType:"application/json",data:b});d.done(c)}function getChapContent(a,b){var c=JSON.stringify({chapId:a,preChapId:preChapId,moocId:moocId,content:b});preChapId=a,postData(urlMoocGetChapContOnly,c,cbSetChapContent)}function init(){preChapId="",updateChapId="",moocId=$("#moocId").text(),$("body").on("keyup",preUpdateTitle),$("body").on("blur","#chapTitle",doUpdateTitle)}function preUpdateTitle(a){13==a.keyCode&&"undefined"!=typeof $("#chapTitle").val()&&doUpdateTitle()}function cbSetChapContent(a){$(".loader-wrapper").hide(),$("#moocContent").val(a.content)}function cbQueryTitle(a){$(".loader-wrapper").hide(),$("#chapTitle").val(a.title),$("#chapTitle").select()}function cbReload(){$(".loader-wrapper").hide(),location.href=moocId}function postData(a,b,c){$(".loader-wrapper").show();var d=$.ajax({type:"post",url:a,dataType:"json",contentType:"application/json",data:b});d.done(c)}function getChapContent(a,b){var c=JSON.stringify({chapId:a,preChapId:preChapId,moocId:moocId,content:b});preChapId=a,postData(urlMoocGetChapCont,c,cbSetChapContent)}function doQueryTitle(){jsonData=JSON.stringify({moocId:moocId,chapId:updateChapId}),postData(urlMoocGetChapTitle,jsonData,cbQueryTitle)}function doUpdateTitle(){jsonData=JSON.stringify({moocId:moocId,chapId:updateChapId,chapTitle:$("#chapTitle").val()}),$("#chapTitle").remove(),postData(urlMoocSetChapTitle,jsonData,cbReload)}function doDeleteChap(a){jsonData=JSON.stringify({moocId:moocId,chapId:a}),postData(urlMoocDelChap,jsonData,cbReload)}function doAddChap(a){jsonData=JSON.stringify({moocId:moocId,chapId:a}),postData(urlMoocAddChap,jsonData,cbReload)}function doUpChap(a){jsonData=JSON.stringify({moocId:moocId,chapId:a}),postData(urlMoocUpChap,jsonData,cbReload)}function doDownChap(a){jsonData=JSON.stringify({moocId:moocId,chapId:a}),postData(urlMoocDownChap,jsonData,cbReload)}function init(){var a=io();a.on("uploadProgress",function(a){console.log(a),$(".pg-bar").progressbar("option","value",parseInt(a)),$(".pg-info").text(a+"%")}),$("#defaultForm").validate({wrapper:"span",onfocusout:!1,submitHandler:function(a){doAddNews()}}),$(".pg-bar").progressbar({value:0}),$(".pg-bar").progressbar("option","max",100),$("body").on("click","#UploadBtn",doUpload),$("body").on("change","#uploadFile",preUpload)}function preUpload(){$("#UploadBtn").removeClass("disabled")}function doUpload(){$(".pg-wrapper").show();var a=$("#uploadFile")[0].files[0],b=new FormData;b.append("file",a),$.ajax({url:"/uploadImg",type:"POST",data:b,async:!0,processData:!1,contentType:!1,success:function(a){if(startReq=!1,0==a.code){var b=$.format("![Alt text]({0})",a.data);$("#newsContent").insertAtCaret(b),$(".pg-wrapper").hide()}}})}function doAddNews(){$.ajax({type:"POST",url:"/admin/news",contentType:"application/json",dataType:"json",data:JSON.stringify({title:$("#newsTitle").val(),content:$("#newsContent").val(),id:$.cookie("id")}),success:function(a){99===a.code?alert(a.msg):(notifyInfo("发布成功！"),location.href="/"+a.data._id)}})}function init(){var a=$(".box-msg").text();""!==a&&(notifyInfo(a),$(".box-msg").text(""))}function init(){var a=io();a.on("uploadProgress",function(a){console.log(a),$(".pg-bar").progressbar("option","value",parseInt(a)),$(".pg-info").text(a+"%")}),$("#registerform").validate({errorLabelContainer:"#errorMsg",onfocusout:!1,wrapper:"span",submitHandler:function(a){doRegister()}}),$(".pg-bar").progressbar({value:0}),$(".pg-bar").progressbar("option","max",100),$("body").on("click","#UploadBtn",doUpload),$("body").on("change","#uploadFile",preUpload)}function preUpload(){$("#UploadBtn").removeClass("disabled")}function doUpload(){$(".pg-wrapper").show();var a=$("#uploadFile")[0].files[0],b=new FormData;b.append("file",a),$.ajax({url:"/uploadImg",type:"POST",data:b,async:!0,processData:!1,contentType:!1,success:function(a){startReq=!1,0===a.code&&($("#userThumb").attr("src",a.data),$(".pg-wrapper").hide())}})}function doRegister(){$.ajax({type:"POST",url:"/register",contentType:"application/json",dataType:"json",data:JSON.stringify({usr:$("#new-usr").val(),pwd:$("#new-pwd").val(),email:$("#new-email").val(),adr:$("#new-address").val(),userThumb:$("#userThumb").attr("src")}),success:function(a){99===a.code?($(".register-box-msg").text(a.msg),console.log("注册失败！")):(console.log("注册成功！"),$.cookie("username",a.data.username,{expires:30}),$.cookie("password",a.data.password,{expires:30}),$.cookie("id",a.data._id,{expires:30}),$.cookie("userThumb",a.data.userThumb,{expires:30}),location.href="/login")}})}$(init),$('[data-toggle="select"]').on("click",function(a){a.preventDefault();var b=$(this),c=b.data("cid"),d=b.data("rid");$("#cid").length>0?$("#cid").val(c):$("<input>").attr({id:"cid",type:"hidden",value:c}).appendTo("#commentForm"),$("#rid").length>0?$("#rid").val(d):$("<input>").attr({id:"rid",type:"hidden",value:d}).appendTo("#commentForm")}),$(init);var preChapId,moocId,updateChapId,selectChapId;$(init),$('[data-toggle="select"]').on("click",function(a){a.preventDefault();var b=$(this),c=b.data("id");if("undefined"!=typeof c){selectChapId=c;var d=$("#moocContent").val();$('[data-toggle="select"]').removeClass("mooc-active"),b.addClass("mooc-active"),getChapContent(c,d)}});var preChapId,moocId,updateChapId,selectChapId;$(init),$('[data-toggle="select"]').on("click",function(a){a.preventDefault();var b=$(this),c=b.data("id");if("undefined"!=typeof c){selectChapId=c;var d=$("#moocContent").val();$('[data-toggle="select"]').removeClass("mooc-active"),b.addClass("mooc-active"),getChapContent(c,d)}}),$('[data-toggle="select"]').on("mouseover",function(a){a.preventDefault();var b=$(this);b.find(".mooc-button").show()}),$('[data-toggle="select"]').on("mouseout",function(a){a.preventDefault();var b=$(this);b.find(".mooc-button").hide()}),$('[data-button="edit"]').on("click",function(a){a.preventDefault(),a.stopPropagation();var b=$(this);updateChapId=b.parent().parent().data("id"),b.parent().parent().prepend('<input type="text" class="form-control" id="chapTitle">'),doQueryTitle()}),$('[data-button="del"]').on("click",function(a){a.preventDefault(),a.stopPropagation();var b=$(this);updateChapId=b.parent().parent().data("id"),doDeleteChap(updateChapId)}),$('[data-button="add"]').on("click",function(a){a.preventDefault(),a.stopPropagation();$(this);doAddChap(selectChapId)}),$('[data-button="up"]').on("click",function(a){a.preventDefault(),a.stopPropagation();var b=$(this);doUpChap(b.parent().parent().data("id"))}),$('[data-button="down"]').on("click",function(a){a.preventDefault(),a.stopPropagation();var b=$(this);doDownChap(b.parent().parent().data("id"))}),$(init),$(init),$(init);